version: "3.1"

intents:
  - choose_movie
  - choose_quality
  - choose_client_ip
  - greet
  - confirm_send

slots:
  movie:
    type: text
    mappings:
      - type: from_entity
        entity: movie

  quality:
    type: text
    mappings:
      - type: from_entity
        entity: quality

  client_ip:
    type: text
    initial_value: ""
    mappings:
      - type: from_entity
        entity: client_ip

  eta_min_threshold:
    type: float
    initial_value: 1.0
    mappings:
      - type: custom

  request_id:
    type: text
    mappings:
      - type: custom

entities:
  - movie
  - quality
  - client_ip

responses:
  utter_greet:
    - text: "Hi! I can suggest some movies. Choose one:"
      buttons:
        - title: "Inception"
          payload: '/choose_movie{{"movie":"Inception"}}'
        - title: "Interstellar"
          payload: '/choose_movie{{"movie":"Interstellar"}}'
        - title: "The Matrix"
          payload: '/choose_movie{{"movie":"The Matrix"}}'

  utter_choose_quality:
    - text: "Select your subscription level:"
      buttons:
        - title: "Basic (720p)"
          payload: '/choose_quality{{"quality":"Low"}}'
        - title: "Standard (1080p)"
          payload: '/choose_quality{{"quality":"Medium"}}'
        - title: "Premium (4k)"
          payload: '/choose_quality{{"quality":"High"}}'

  utter_choose_client_ip:
    - text: "Select the client address:"
      buttons:
        - title: "Client 10.0.0.1"
          payload: '/choose_client_ip{{"client_ip":"10.0.0.1"}}'
        - title: "Client 10.0.0.2"
          payload: '/choose_client_ip{{"client_ip":"10.0.0.2"}}'
        - title: "Client 10.0.0.3"
          payload: '/choose_client_ip{{"client_ip":"10.0.0.3"}}'

  utter_confirm:
    - text: "You chose '{movie}' at '{quality}' quality from IP {client_ip}. Using η_min={eta_min_threshold}. Sending to ONOS…"
    
  utter_confirm_send:
    - text: "✓ Request sent to ONOS. η_min will be updated in background if needed."

  utter_eta_min_updated:
    - text: "✓ η_min updated for '{movie}' at '{quality}': {eta_min_threshold}"

actions:
  - utter_greet
  - utter_choose_quality
  - utter_choose_client_ip
  - utter_confirm
  - utter_confirm_send
  - utter_eta_min_updated
  - action_set_movie_slot
  - action_set_quality_slot
  - action_set_client_ip_slot
  - action_calculate_eta_min
  - action_send_json_to_onos
  - action_update_eta_min_background
